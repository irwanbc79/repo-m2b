<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice {{ $invoice->invoice_number }}</title>
    <style>
        /* UKURAN KERTAS: 9.5 inch x 11 inch (Continuous Form Double Sheet) */
        @page {
            size: 9.5in 11in;
            margin: 0.3in 0.25in;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Courier New', Courier, monospace;
            font-size: 10pt;
            line-height: 1.3;
            color: #000;
            background: #fff;
        }
        
        .invoice-container {
            width: 9in;
            max-height: 10.4in;
            margin: 0 auto;
            padding: 0.2in;
        }
        
        /* HEADER */
        .header {
            display: flex;
            justify-content: space-between;
            padding-bottom: 8px;
            border-bottom: 2px double #000;
            margin-bottom: 12px;
        }
        
        .company-info { flex: 1; }
        .company-name { font-size: 14pt; font-weight: bold; text-transform: uppercase; }
        .company-tagline { font-size: 8pt; font-style: italic; margin-bottom: 4px; }
        .company-details { font-size: 8pt; line-height: 1.4; }
        
        .invoice-title-box { text-align: right; padding-left: 15px; }
        .invoice-label {
            font-size: 18pt;
            font-weight: bold;
            letter-spacing: 3px;
            border: 2px solid #000;
            padding: 3px 15px;
            display: inline-block;
        }
        .invoice-number { font-size: 11pt; font-weight: bold; margin-top: 5px; }
        
        /* INFO SECTION */
        .info-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            gap: 20px;
        }
        
        .customer-box {
            flex: 1.3;
            border: 1px solid #000;
            padding: 8px 10px;
        }
        .customer-box-title { font-size: 8pt; font-weight: bold; text-decoration: underline; margin-bottom: 5px; }
        .customer-name { font-size: 10pt; font-weight: bold; margin-bottom: 3px; }
        .customer-address { font-size: 9pt; line-height: 1.4; }
        
        .invoice-details-box { flex: 0.7; }
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px dotted #666;
        }
        .detail-row:last-child { border-bottom: none; }
        .detail-label { font-size: 9pt; }
        .detail-value { font-size: 9pt; font-weight: bold; text-align: right; }
        
        /* TABLE */
        .items-table { width: 100%; border-collapse: collapse; margin-bottom: 12px; }
        .items-table thead tr { background: #000; }
        .items-table th {
            color: white;
            font-size: 9pt;
            font-weight: bold;
            padding: 6px 5px;
            text-align: left;
            border: 1px solid #000;
        }
        .items-table th.center { text-align: center; }
        .items-table th.right { text-align: right; }
        .items-table td {
            font-size: 9pt;
            padding: 5px;
            border: 1px solid #000;
            vertical-align: top;
        }
        .items-table td.center { text-align: center; }
        .items-table td.right { text-align: right; }
        
        /* TOTALS */
        .totals-section { display: flex; justify-content: flex-end; margin-bottom: 10px; }
        .totals-box { width: 260px; border: 1px solid #000; }
        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 8px;
            border-bottom: 1px solid #000;
        }
        .total-row:last-child { border-bottom: none; }
        .total-row.grand-total { background: #000; color: white; font-weight: bold; }
        .total-label, .total-value { font-size: 9pt; }
        .total-value { font-weight: bold; }
        
        /* TERBILANG */
        .terbilang-section {
            border: 1px solid #000;
            padding: 6px 10px;
            margin-bottom: 12px;
            background: #f0f0f0;
        }
        .terbilang-label { font-size: 8pt; font-weight: bold; }
        .terbilang-text { font-size: 9pt; font-style: italic; font-weight: bold; }
        
        /* FOOTER */
        .footer-section { display: flex; gap: 20px; margin-bottom: 15px; }
        .notes-box { flex: 1; }
        .bank-box { flex: 1; border: 1px solid #000; padding: 8px; }
        .section-title { font-size: 9pt; font-weight: bold; text-decoration: underline; margin-bottom: 5px; }
        .notes-content, .bank-info { font-size: 8pt; line-height: 1.4; }
        .bank-account { font-family: 'Courier New', monospace; font-size: 10pt; font-weight: bold; }
        
        /* SIGNATURE SECTION */
        .signature-section {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            align-items: flex-start;
        }
        
        .signature-box {
            text-align: center;
            width: 200px;
        }
        
        .signature-title { font-size: 9pt; margin-bottom: 10px; }
        .signature-line { border-top: 1px solid #000; padding-top: 5px; margin-top: 50px; }
        .signature-name { font-size: 9pt; font-weight: bold; }
        .signature-role { font-size: 8pt; }
        
        /* STAMP & SIGNATURE IMAGE */
        .stamp-signature-box {
            text-align: center;
            position: relative;
        }
        
        .stamp-signature-box .sig-location {
            font-size: 9pt;
            margin-bottom: 5px;
        }
        
        .stamp-signature-box .sig-company {
            font-size: 9pt;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stamp-signature-box .sig-image {
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stamp-signature-box .sig-image img {
            max-height: 70px;
            max-width: 150px;
        }
        
        .stamp-signature-box .sig-name {
            font-size: 9pt;
            font-weight: bold;
            border-top: 1px solid #000;
            padding-top: 3px;
            display: inline-block;
            min-width: 120px;
        }
        
        .stamp-signature-box .sig-role {
            font-size: 8pt;
        }
        
        /* STATUS */
        .status-badge { display: inline-block; padding: 2px 10px; border: 2px solid #000; font-size: 9pt; font-weight: bold; }
        .status-unpaid { background: #fff; }
        .status-paid { background: #000; color: #fff; }
        
        /* PRINT BUTTON BAR */
        .print-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #1a365d;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .print-bar-title {
            font-family: Arial, sans-serif;
            font-size: 14px;
        }
        
        .print-bar-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn-print {
            background: #48bb78;
            color: white;
            border: none;
            padding: 10px 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
        }
        
        .btn-print:hover { background: #38a169; }
        
        .btn-back {
            background: #718096;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 5px;
            text-decoration: none;
        }
        
        .btn-back:hover { background: #4a5568; }
        
        /* Spacing for fixed bar */
        body { padding-top: 60px; }
        
        /* PRINT STYLES */
        @media print {
            body { 
                -webkit-print-color-adjust: exact !important; 
                print-color-adjust: exact !important;
                padding-top: 0;
            }
            .invoice-container { width: 100%; padding: 0; }
            .no-print { display: none !important; }
            .print-bar { display: none !important; }
        }
    </style>
</head>
<body>
    {{-- Print Bar --}}
    <div class="print-bar no-print">
        <div class="print-bar-title">
            üìÑ Preview Invoice: <strong>{{ $invoice->invoice_number }}</strong>
        </div>
        <div class="print-bar-buttons">
            <a href="{{ route('finance.simple-invoice.index') }}" class="btn-back">‚Üê Kembali</a>
            <button class="btn-print" onclick="window.print()">üñ®Ô∏è CETAK INVOICE</button>
        </div>
    </div>
    
    <div class="invoice-container">
        {{-- HEADER --}}
        <div class="header">
            <div class="company-info">
                <div class="company-name">PT. MORA MULTI BERKAH</div>
                <div class="company-tagline">Logistic Solution & Freight Forwarding</div>
                <div class="company-details">
                    Jl. Kapt. Sumarsono Komp. Graha Metropolitan Blok G No. 14<br>
                    Medan, Sumatera Utara - Indonesia<br>
                    Telp: 061-44020012 | Email: finance@m2b.co.id
                </div>
            </div>
            <div class="invoice-title-box">
                <div class="invoice-label">INVOICE</div>
                <div class="invoice-number">{{ $invoice->invoice_number }}</div>
                <div style="margin-top: 8px;">
                    <span class="status-badge status-{{ $invoice->status }}">
                        {{ $invoice->status === 'paid' ? 'LUNAS' : 'BELUM BAYAR' }}
                    </span>
                </div>
            </div>
        </div>
        
        {{-- CUSTOMER & INVOICE INFO --}}
        <div class="info-section">
            <div class="customer-box">
                <div class="customer-box-title">TAGIHAN KEPADA:</div>
                <div class="customer-name">{{ $invoice->customer_name }}</div>
                <div class="customer-address">{!! nl2br(e($invoice->customer_address)) !!}</div>
            </div>
            <div class="invoice-details-box">
                <div class="detail-row">
                    <span class="detail-label">Tanggal:</span>
                    <span class="detail-value">{{ $invoice->invoice_date->format('d/m/Y') }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Jatuh Tempo:</span>
                    <span class="detail-value">{{ $invoice->invoice_date->addDays(30)->format('d/m/Y') }}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Currency:</span>
                    <span class="detail-value">{{ $invoice->currency }}</span>
                </div>
                @if($invoice->status === 'paid' && $invoice->paid_date)
                <div class="detail-row">
                    <span class="detail-label">Tgl Bayar:</span>
                    <span class="detail-value">{{ $invoice->paid_date->format('d/m/Y') }}</span>
                </div>
                @endif
            </div>
        </div>
        
        {{-- ITEMS TABLE --}}
        <table class="items-table">
            <thead>
                <tr>
                    <th style="width: 30px;" class="center">NO</th>
                    <th style="width: auto;">KETERANGAN</th>
                    <th style="width: 50px;" class="center">QTY</th>
                    <th style="width: 100px;" class="right">HARGA</th>
                    <th style="width: 110px;" class="right">JUMLAH</th>
                </tr>
            </thead>
            <tbody>
                @forelse($invoice->items as $index => $item)
                <tr>
                    <td class="center">{{ $index + 1 }}</td>
                    <td>{{ $item->description }}</td>
                    <td class="center">{{ number_format($item->quantity, 0, ',', '.') }}</td>
                    <td class="right">{{ number_format($item->unit_price, 0, ',', '.') }}</td>
                    <td class="right">{{ number_format($item->amount, 0, ',', '.') }}</td>
                </tr>
                @empty
                <tr>
                    <td colspan="5" class="center" style="padding: 20px;">- Tidak ada item -</td>
                </tr>
                @endforelse
                @for($i = count($invoice->items ?? []); $i < 6; $i++)
                <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
                @endfor
            </tbody>
        </table>
        
        {{-- TOTALS --}}
        <div class="totals-section">
            <div class="totals-box">
                <div class="total-row">
                    <span class="total-label">SUBTOTAL</span>
                    <span class="total-value">{{ $invoice->currency }} {{ number_format($invoice->subtotal ?? $invoice->total, 0, ',', '.') }}</span>
                </div>
                <div class="total-row grand-total">
                    <span class="total-label">TOTAL</span>
                    <span class="total-value">{{ $invoice->currency }} {{ number_format($invoice->total, 0, ',', '.') }}</span>
                </div>
            </div>
        </div>
        
        {{-- TERBILANG --}}
        <div class="terbilang-section">
            <span class="terbilang-label">TERBILANG:</span>
            <span class="terbilang-text"># {{ $invoice->terbilang }} #</span>
        </div>
        
        {{-- NOTES & BANK INFO --}}
        <div class="footer-section">
            <div class="notes-box">
                <div class="section-title">CATATAN:</div>
                <div class="notes-content">
                    @if($invoice->notes)
                        {!! nl2br(e($invoice->notes)) !!}
                    @else
                        - Pembayaran mohon ditransfer ke rekening yang tertera.<br>
                        - Cantumkan nomor invoice pada berita transfer.
                    @endif
                </div>
            </div>
            <div class="bank-box">
                <div class="section-title">INFORMASI TRANSFER:</div>
                <div class="bank-info">
                    <strong>Bank:</strong> PT BANK MANDIRI (Persero) Tbk<br>
                    <strong>No. Rek:</strong> <span class="bank-account">106-00-5598809-6</span><br>
                    <strong>Atas Nama:</strong> PT. MORA MULTI BERKAH
                </div>
            </div>
        </div>
        
        {{-- SIGNATURE WITH STAMP --}}
        <div class="signature-section">
            {{-- Penerima --}}
            <div class="signature-box">
                <div class="signature-title">Penerima,</div>
                <div class="signature-line">
                    <div class="signature-name">(________________)</div>
                </div>
            </div>
            
            {{-- Stamp + Signature --}}
            <div class="stamp-signature-box">
                <div class="sig-location">Medan, {{ $invoice->invoice_date->format('d F Y') }}</div>
                <div class="sig-company">PT. MORA MULTI BERKAH</div>
                <div class="sig-image" style="position: relative; height: 80px;">
                    @if(file_exists(public_path('images/assets/signatures/stamp_m2b.png')))
                        <img src="{{ asset('images/assets/signatures/stamp_m2b.png') }}" 
                             alt="Stamp" 
                             style="position: absolute; left: 50%; transform: translateX(-50%); max-height: 80px; opacity: 0.85;">
                    @endif
                    @if(file_exists(public_path('images/assets/signatures/sign_nurul.png')))
                        <img src="{{ asset('images/assets/signatures/sign_nurul.png') }}" 
                             alt="Signature" 
                             style="position: absolute; left: 50%; transform: translateX(-50%); max-height: 60px; z-index: 10;">
                    @endif
                </div>
                <div class="sig-name">Nurul Asyikin</div>
                <div class="sig-role">Finance Department</div>
            </div>
        </div>
    </div>
    
    <script>
        // Auto print jika ada parameter
        if (window.location.search.includes('auto=1')) {
            window.onload = function() { window.print(); }
        }
    </script>
</body>
</html>
