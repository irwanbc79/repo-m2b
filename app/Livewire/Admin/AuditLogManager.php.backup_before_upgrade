<?php

namespace App\Livewire\Admin;

use Livewire\Component;
use Livewire\WithPagination;
use App\Models\ActivityLog;
use Illuminate\Support\Facades\Auth;

class AuditLogManager extends Component
{
    use WithPagination;
    public $search = '';

    public function render()
    {
        // Proteksi: Hanya Admin yang boleh lihat
        if (Auth::user()->role !== 'admin') abort(403);

        $logs = ActivityLog::where('description', 'like', '%'.$this->search.'%')
            ->orWhere('target_ref', 'like', '%'.$this->search.'%')
            ->orWhere('user_name', 'like', '%'.$this->search.'%')
            ->orWhere('module', 'like', '%'.$this->search.'%')
            ->latest()
            ->paginate(20);

        return view('livewire.admin.audit-log-manager', ['logs' => $logs])->layout('layouts.admin');
    }
}