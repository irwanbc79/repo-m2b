<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Request;

class ActivityLog extends Model
{
    use HasFactory;

    protected $fillable = [
        'user_id', 'user_name', 'role', 
        'action', 'module', 'target_ref', 
        'description', 'ip_address'
    ];

    public function user()
    {
        return $this->belongsTo(User::class);
    }

    // FUNGSI SAKTI: Panggil ini untuk mencatat log
    public static function record($module, $action, $targetRef, $description = null)
    {
        if (Auth::check()) {
            self::create([
                'user_id'     => Auth::id(),
                'user_name'   => Auth::user()->name,
                'role'        => Auth::user()->role,
                'action'      => $action,     // Contoh: UPDATE
                'module'      => $module,     // Contoh: Shipment
                'target_ref'  => $targetRef,  // Contoh: JOB-001
                'description' => $description,// Detail perubahan
                'ip_address'  => Request::ip(),
            ]);
        }
    }
}